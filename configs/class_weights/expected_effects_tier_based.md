# Tier-based Class Weights 예상 효과 분석

## 현재 가중치 설정

### Carpal Bone (손목뼈 8개)
- **Pisiform**: 3.0x (가장 낮은 dice: 0.9182)
- **Trapezoid**: 3.0x (두 번째로 낮음: 0.9271)
- **Trapezium**: 2.5x (0.9538)
- **Hamate**: 2.5x (0.9573)
- **Triquetrum**: 2.5x (0.9595)
- **Lunate**: 2.0x (0.9655)
- **Capitate**: 2.0x (0.9670)
- **Scaphoid**: 1.5x (0.9753)

**평균 가중치**: ~2.4x

### Finger (일부만 가중치)
- **finger-1, 16, 17**: 1.5x (낮은 dice: 0.9672, 0.9706, 0.9704)
- **나머지 finger**: 1.0x

### Arm
- **Radius, Ulna**: 1.0x (이미 높은 dice: 0.9911, 0.9897)

---

## 예상 장점 ✅

### 1. **Carpal Bone 성능 향상**
- **가장 큰 이점**: 손목뼈 8개 클래스의 loss가 1.5~3배 증가
- 모델이 손목뼈 학습에 더 집중
- **예상 개선**: 
  - Pisiform: 0.9182 → 0.93~0.94 (약 1.2~2.2%p 향상)
  - Trapezoid: 0.9271 → 0.94~0.95 (약 1.3~2.3%p 향상)
  - 평균적으로 Carpal Bone: 0.955 → 0.965~0.970 (약 1~1.5%p 향상)

### 2. **균형잡힌 학습**
- Dice 점수에 따라 세밀하게 가중치 부여
- 가장 낮은 클래스(Pisiform, Trapezoid)에 최대 가중치(3.0x)
- 상대적으로 높은 클래스(Scaphoid)에는 적당한 가중치(1.5x)

### 3. **전체 평균 Dice 향상 가능성**
- Carpal Bone이 전체 평균에 큰 영향
- Carpal Bone 개선 → 전체 avg_dice 향상
- **현재**: 0.9731 → **예상**: 0.975~0.977

### 4. **낮은 Finger도 함께 개선**
- finger-1, 16, 17도 1.5x 가중치
- 전체적으로 낮은 클래스에 집중

---

## 예상 단점 ⚠️

### 1. **Finger 성능 약간 하락 가능성**
- **가장 큰 우려**: Finger 클래스의 loss 비중이 상대적으로 감소
- Carpal Bone에 과도하게 집중 → Finger 학습 약화
- **예상 영향**: 
  - 높은 finger (0.98+): 거의 영향 없음 (이미 충분히 학습됨)
  - 중간 finger (0.97~0.98): 약간 하락 가능 (0.01~0.02%p)
  - 낮은 finger (0.97-): 1.5x 가중치로 보완

### 2. **학습 불안정성**
- Loss scale이 클래스마다 다름 → gradient 불균형
- **위험도**: 중간 (가중치 차이가 3배까지)
- **완화 요인**: Dice loss는 이미 클래스별로 계산되므로 상대적으로 안정적

### 3. **과적합 위험**
- Carpal Bone에 과도하게 집중 → 다른 클래스 일반화 저하
- **위험도**: 낮음 (가중치가 3배 정도로 적당함)

### 4. **학습 속도 영향**
- Loss 계산 시 가중치 곱셈 추가 → 미미한 오버헤드
- **영향**: 거의 없음

---

## 시나리오별 예상 결과

### 시나리오 1: 최선의 경우 (60% 확률)
- **Carpal Bone**: 0.955 → 0.970 (+1.5%p)
- **Finger**: 0.979 → 0.978 (-0.1%p, 거의 유지)
- **전체 avg_dice**: 0.9731 → 0.976~0.977 (+0.3~0.4%p)
- **결과**: ✅ **성공적** - Carpal Bone 개선, Finger 유지

### 시나리오 2: 균형잡힌 경우 (30% 확률)
- **Carpal Bone**: 0.955 → 0.965 (+1.0%p)
- **Finger**: 0.979 → 0.977 (-0.2%p)
- **전체 avg_dice**: 0.9731 → 0.975 (+0.2%p)
- **결과**: ✅ **양호** - Carpal Bone 개선, Finger 약간 하락

### 시나리오 3: 최악의 경우 (10% 확률)
- **Carpal Bone**: 0.955 → 0.960 (+0.5%p, 개선 미미)
- **Finger**: 0.979 → 0.975 (-0.4%p, 하락)
- **전체 avg_dice**: 0.9731 → 0.973~0.974 (거의 변화 없음)
- **결과**: ⚠️ **실망** - 전체적으로 변화 없음

---

## 핵심 판단 기준

### ✅ **성공할 가능성이 높은 이유**
1. **Carpal Bone이 명확히 낮음** (0.955 vs 0.979)
2. **가중치가 합리적** (1.5~3.0x, 과도하지 않음)
3. **Finger는 이미 높아서** 하락 여지가 적음
4. **세밀한 가중치** (tier_based)로 균형잡힌 접근

### ⚠️ **주의해야 할 점**
1. **Finger 성능 모니터링** 필수
2. **학습 초기 불안정** 가능성
3. **전체 avg_dice가 오히려 하락**할 수도 있음 (Finger 하락 > Carpal Bone 상승)

---

## 권장 사항

### 1. **실험 진행**
- ✅ 현재 설정으로 실험 진행 권장
- Carpal Bone 개선이 목표라면 합리적인 전략

### 2. **모니터링 포인트**
- Carpal Bone 8개 클래스별 dice 추적
- Finger 클래스 dice 추적 (특히 높은 finger들)
- 전체 avg_dice 추적
- Loss 값 추적 (불균형 확인)

### 3. **대안 고려**
- 만약 Finger 하락이 크다면:
  - Carpal Bone 가중치를 2.0x~2.5x로 낮추기
  - 또는 `class_weights_carpal_25x.json` 사용 (모든 Carpal Bone 2.5x)

---

## 결론

**예상**: ✅ **긍정적 효과가 클 가능성 높음**

- Carpal Bone 성능 향상: **높은 확률** (1~1.5%p)
- Finger 성능 유지: **중간 확률** (약간 하락 가능)
- 전체 avg_dice 향상: **중간 확률** (+0.2~0.4%p)

**핵심**: Carpal Bone 개선이 목표라면 이 전략이 **가장 합리적**입니다.

