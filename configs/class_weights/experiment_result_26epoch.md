# Class Weights 실험 결과 분석 (26에폭)

## 현재 결과 (26에폭) vs 기존 Best (29에폭)

### 전체 평균
- **현재**: 0.9688
- **기존**: 0.9731
- **변화**: -0.0043 (-0.43%p) ⚠️

### Carpal Bone (손목뼈 8개)

| 클래스 | 현재 (26e) | 기존 (29e) | 변화 | 가중치 |
|--------|-----------|-----------|------|--------|
| Pisiform | 0.9123 | 0.9182 | -0.0059 ⚠️ | 3.0x |
| Trapezoid | 0.9209 | 0.9271 | -0.0062 ⚠️ | 3.0x |
| Trapezium | 0.9467 | 0.9538 | -0.0071 ⚠️ | 2.5x |
| Hamate | 0.9500 | 0.9573 | -0.0073 ⚠️ | 2.5x |
| Triquetrum | 0.9550 | 0.9595 | -0.0045 ⚠️ | 2.5x |
| Lunate | 0.9614 | 0.9655 | -0.0041 ⚠️ | 2.0x |
| Capitate | 0.9614 | 0.9670 | -0.0056 ⚠️ | 2.0x |
| Scaphoid | 0.9712 | 0.9753 | -0.0041 ⚠️ | 1.5x |

**Carpal Bone 평균**:
- 현재: ~0.947
- 기존: ~0.955
- **변화: -0.008 (-0.8%p)** ⚠️⚠️

### Finger (손가락 19개)

| 클래스 | 현재 (26e) | 기존 (29e) | 변화 | 가중치 |
|--------|-----------|-----------|------|--------|
| finger-1 | 0.9645 | 0.9672 | -0.0027 | 1.5x |
| finger-16 | 0.9663 | 0.9706 | -0.0043 | 1.5x |
| finger-17 | 0.9683 | 0.9704 | -0.0021 | 1.5x |
| 나머지 | 대부분 하락 | - | - | 1.0x |

**Finger 평균**: 약간 하락 (정확한 평균 계산 필요)

### Arm
- Radius: 0.9895 (기존 0.9911) -0.0016
- Ulna: 0.9886 (기존 0.9897) -0.0011

---

## 분석

### ⚠️ 우려되는 점

1. **Carpal Bone이 오히려 하락**
   - 가중치를 높였는데도 성능이 하락
   - 평균 -0.8%p 하락
   - 특히 높은 가중치(3.0x)를 준 Pisiform, Trapezoid가 더 많이 하락

2. **전체 avg_dice 하락**
   - 0.9731 → 0.9688 (-0.43%p)
   - 아직 26에폭이지만, 기존 29에폭보다 낮음

3. **학습 불안정 가능성**
   - Class weights로 인한 gradient 불균형
   - Loss scale 증가로 인한 학습 패턴 변화

### 🤔 가능한 원인

1. **에폭 수 차이**
   - 현재: 26에폭
   - 기존: 29에폭 (best)
   - **아직 학습 중일 수 있음**

2. **Loss scale 증가**
   - 평균 가중치 1.47배 → gradient 증가
   - LR이 1e-3로 그대로라서 학습이 불안정할 수 있음

3. **과도한 가중치**
   - 3.0x 가중치가 너무 높아서 오히려 역효과
   - Gradient 불균형으로 학습 방해

4. **학습 초기 단계**
   - 26에폭은 아직 초기/중기 단계
   - 더 학습하면 개선될 수 있음

---

## 권장 사항

### 1. **더 학습 기다리기** (우선)
- 26에폭은 아직 초기 단계
- 최소 30~40에폭까지 기다려보기
- Best epoch가 언제인지 확인

### 2. **LR 조정 고려**
- 현재 LR: 1e-3
- Loss scale 증가(1.47배) 고려하여 **8e-4로 낮추기** 고려
- 학습 안정성 향상 가능

### 3. **가중치 조정 고려**
- 만약 최종 결과도 하락한다면:
  - 최대 가중치를 3.0x → 2.5x로 낮추기
  - 또는 `class_weights_carpal_25x.json` 사용 (모두 2.5x)

### 4. **모니터링 포인트**
- Best epoch 확인
- Carpal Bone 클래스별 추이 확인
- Loss 값 추이 확인 (불안정한지)

---

## 결론

**현재 상태**: ⚠️ **성능 하락 중**

하지만:
- 아직 26에폭 (기존 best는 29에폭)
- 더 학습하면 개선될 가능성 있음
- 최종 판단은 40~50에폭 후에

**다음 단계**:
1. 더 학습 기다리기
2. Best epoch 확인
3. 최종 결과가 하락하면 → LR 낮추기 또는 가중치 조정

